<!DOCTYPE html>
<html>
<head>
  <title>webpack-dev-server</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/.bin/webpack-dev-server";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>webpack-dev-server</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>
<span class="hljs-meta">
'use strict'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>eslint-disable
import/order,
import/no-extraneous-dependencies,
global-require,
no-shadow,
no-console,
multiline-ternary,
arrow-parens,
array-bracket-spacing,
space-before-function-paren</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'debug'</span>)(<span class="hljs-string">'webpack-dev-server'</span>);

<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> net = <span class="hljs-built_in">require</span>(<span class="hljs-string">'net'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-keyword">const</span> portfinder = <span class="hljs-built_in">require</span>(<span class="hljs-string">'portfinder'</span>);
<span class="hljs-keyword">const</span> importLocal = <span class="hljs-built_in">require</span>(<span class="hljs-string">'import-local'</span>);

<span class="hljs-keyword">const</span> yargs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'yargs'</span>);
<span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>);

<span class="hljs-keyword">const</span> options = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./options'</span>);

<span class="hljs-keyword">const</span> {
  colors,
  status,
  version,
  bonjour,
  defaultTo
} = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./utils'</span>);

<span class="hljs-keyword">const</span> Server = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/Server'</span>);

<span class="hljs-keyword">const</span> addEntries = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/utils/addEntries'</span>);
<span class="hljs-keyword">const</span> createDomain = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/utils/createDomain'</span>);
<span class="hljs-keyword">const</span> createLogger = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/utils/createLogger'</span>);

<span class="hljs-keyword">let</span> server;

<span class="hljs-keyword">const</span> signals = [ <span class="hljs-string">'SIGINT'</span>, <span class="hljs-string">'SIGTERM'</span> ];

signals.forEach(<span class="hljs-function">(<span class="hljs-params">signal</span>) =&gt;</span> {
  process.on(signal, () =&gt; {
    <span class="hljs-keyword">if</span> (server) {
      server.close(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>eslint-disable-next-line no-process-exit</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        process.exit();
      });
    } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>eslint-disable-next-line no-process-exit</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      process.exit();
    }
  });
});

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Prefer the local installation of webpack-dev-server</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">if</span> (importLocal(__filename)) {
  debug(<span class="hljs-string">'Using local install of webpack-dev-server'</span>);

  <span class="hljs-keyword">return</span>;
}

<span class="hljs-keyword">try</span> {
  <span class="hljs-built_in">require</span>.resolve(<span class="hljs-string">'webpack-cli'</span>);
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'The CLI moved into a separate package: webpack-cli'</span>);
  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Please install \'webpack-cli\' in addition to webpack itself to use the CLI'</span>);
  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'-&gt; When using npm: npm i -D webpack-cli'</span>);
  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'-&gt; When using yarn: yarn add -D webpack-cli'</span>);

  process.exitCode = <span class="hljs-number">1</span>;
}

yargs.usage(
  <span class="hljs-string">`<span class="hljs-subst">${version()}</span>\nUsage:  https://webpack.js.org/configuration/dev-server/`</span>
);

<span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-cli/bin/config-yargs'</span>)(yargs);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>It is important that this is done after the webpack yargs config,
so it overrides webpack's version info.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">yargs.version(version());
yargs.options(options);

<span class="hljs-keyword">const</span> argv = yargs.argv;

<span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-cli/bin/convert-argv'</span>)(yargs, argv, {
  <span class="hljs-attr">outputFilename</span>: <span class="hljs-string">'/bundle.js'</span>
});
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>Taken out of yargs because we must know if
it wasn't given by the user, in which case
we should use portfinder.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> DEFAULT_PORT = <span class="hljs-number">8080</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processOptions</span> (<span class="hljs-params">config</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>processOptions {Promise}</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> config.then === <span class="hljs-string">'function'</span>) {
    config.then(processOptions).catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
      <span class="hljs-built_in">console</span>.error(err.stack || err);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>eslint-disable-next-line no-process-exit</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      process.exit();
    });

    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">const</span> firstWpOpt = <span class="hljs-built_in">Array</span>.isArray(config)
    ? config[<span class="hljs-number">0</span>]
    : config;

  <span class="hljs-keyword">const</span> options = config.devServer || firstWpOpt.devServer || {};

  <span class="hljs-keyword">if</span> (argv.bonjour) {
    options.bonjour = <span class="hljs-literal">true</span>;
  }

  <span class="hljs-keyword">if</span> (argv.host !== <span class="hljs-string">'localhost'</span> || !options.host) {
    options.host = argv.host;
  }

  <span class="hljs-keyword">if</span> (argv[<span class="hljs-string">'allowed-hosts'</span>]) {
    options.allowedHosts = argv[<span class="hljs-string">'allowed-hosts'</span>].split(<span class="hljs-string">','</span>);
  }

  <span class="hljs-keyword">if</span> (argv.public) {
    options.public = argv.public;
  }

  <span class="hljs-keyword">if</span> (argv.socket) {
    options.socket = argv.socket;
  }

  <span class="hljs-keyword">if</span> (argv.progress) {
    options.progress = argv.progress;
  }

  <span class="hljs-keyword">if</span> (!options.publicPath) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>eslint-disable-next-line</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    options.publicPath = firstWpOpt.output &amp;&amp; firstWpOpt.output.publicPath || <span class="hljs-string">''</span>;

    <span class="hljs-keyword">if</span> (
      !<span class="hljs-regexp">/^(https?:)?\/\//</span>.test(options.publicPath) &amp;&amp;
      options.publicPath[<span class="hljs-number">0</span>] !== <span class="hljs-string">'/'</span>
    ) {
      options.publicPath = <span class="hljs-string">`/<span class="hljs-subst">${options.publicPath}</span>`</span>;
    }
  }

  <span class="hljs-keyword">if</span> (!options.filename) {
    options.filename = firstWpOpt.output &amp;&amp; firstWpOpt.output.filename;
  }

  <span class="hljs-keyword">if</span> (!options.watchOptions) {
    options.watchOptions = firstWpOpt.watchOptions;
  }

  <span class="hljs-keyword">if</span> (argv.stdin) {
    process.stdin.on(<span class="hljs-string">'end'</span>, () =&gt; {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>eslint-disable-next-line no-process-exit</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      process.exit(<span class="hljs-number">0</span>);
    });

    process.stdin.resume();
  }

  <span class="hljs-keyword">if</span> (!options.hot) {
    options.hot = argv.hot;
  }

  <span class="hljs-keyword">if</span> (!options.hotOnly) {
    options.hotOnly = argv[<span class="hljs-string">'hot-only'</span>];
  }

  <span class="hljs-keyword">if</span> (!options.clientLogLevel) {
    options.clientLogLevel = argv[<span class="hljs-string">'client-log-level'</span>];
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>eslint-disable-next-line</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (options.contentBase === <span class="hljs-literal">undefined</span>) {
    <span class="hljs-keyword">if</span> (argv[<span class="hljs-string">'content-base'</span>]) {
      options.contentBase = argv[<span class="hljs-string">'content-base'</span>];

      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(options.contentBase)) {
        options.contentBase = options.contentBase.map(<span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> path.resolve(p));
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^[0-9]$/</span>.test(options.contentBase)) {
        options.contentBase = +options.contentBase;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/^(https?:)?\/\//</span>.test(options.contentBase)) {
        options.contentBase = path.resolve(options.contentBase);
      }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>It is possible to disable the contentBase by using
<code>--no-content-base</code>, which results in arg[&quot;content-base&quot;] = false</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (argv[<span class="hljs-string">'content-base'</span>] === <span class="hljs-literal">false</span>) {
      options.contentBase = <span class="hljs-literal">false</span>;
    }
  }

  <span class="hljs-keyword">if</span> (argv[<span class="hljs-string">'watch-content-base'</span>]) {
    options.watchContentBase = <span class="hljs-literal">true</span>;
  }

  <span class="hljs-keyword">if</span> (!options.stats) {
    options.stats = {
      <span class="hljs-attr">cached</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">cachedAssets</span>: <span class="hljs-literal">false</span>
    };
  }

  <span class="hljs-keyword">if</span> (
    <span class="hljs-keyword">typeof</span> options.stats === <span class="hljs-string">'object'</span> &amp;&amp;
    <span class="hljs-keyword">typeof</span> options.stats.colors === <span class="hljs-string">'undefined'</span>
  ) {
    options.stats = <span class="hljs-built_in">Object</span>.assign(
      {},
      options.stats,
      { <span class="hljs-attr">colors</span>: argv.color }
    );
  }

  <span class="hljs-keyword">if</span> (argv.lazy) {
    options.lazy = <span class="hljs-literal">true</span>;
  }

  <span class="hljs-keyword">if</span> (!argv.info) {
    options.noInfo = <span class="hljs-literal">true</span>;
  }

  <span class="hljs-keyword">if</span> (argv.quiet) {
    options.quiet = <span class="hljs-literal">true</span>;
  }

  <span class="hljs-keyword">if</span> (argv.https) {
    options.https = <span class="hljs-literal">true</span>;
  }

  <span class="hljs-keyword">if</span> (argv.cert) {
    options.cert = fs.readFileSync(
      path.resolve(argv.cert)
    );
  }

  <span class="hljs-keyword">if</span> (argv.key) {
    options.key = fs.readFileSync(
      path.resolve(argv.key)
    );
  }

  <span class="hljs-keyword">if</span> (argv.cacert) {
    options.ca = fs.readFileSync(
      path.resolve(argv.cacert)
    );
  }

  <span class="hljs-keyword">if</span> (argv.pfx) {
    options.pfx = fs.readFileSync(
      path.resolve(argv.pfx)
    );
  }

  <span class="hljs-keyword">if</span> (argv[<span class="hljs-string">'pfx-passphrase'</span>]) {
    options.pfxPassphrase = argv[<span class="hljs-string">'pfx-passphrase'</span>];
  }

  <span class="hljs-keyword">if</span> (argv.inline === <span class="hljs-literal">false</span>) {
    options.inline = <span class="hljs-literal">false</span>;
  }

  <span class="hljs-keyword">if</span> (argv[<span class="hljs-string">'history-api-fallback'</span>]) {
    options.historyApiFallback = <span class="hljs-literal">true</span>;
  }

  <span class="hljs-keyword">if</span> (argv.compress) {
    options.compress = <span class="hljs-literal">true</span>;
  }

  <span class="hljs-keyword">if</span> (argv[<span class="hljs-string">'disable-host-check'</span>]) {
    options.disableHostCheck = <span class="hljs-literal">true</span>;
  }

  <span class="hljs-keyword">if</span> (argv[<span class="hljs-string">'open-page'</span>]) {
    options.open = <span class="hljs-literal">true</span>;
    options.openPage = argv[<span class="hljs-string">'open-page'</span>];
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> argv.open !== <span class="hljs-string">'undefined'</span>) {
    options.open = argv.open !== <span class="hljs-string">''</span> ? argv.open : <span class="hljs-literal">true</span>;
  }

  <span class="hljs-keyword">if</span> (options.open &amp;&amp; !options.openPage) {
    options.openPage = <span class="hljs-string">''</span>;
  }

  <span class="hljs-keyword">if</span> (argv.useLocalIp) {
    options.useLocalIp = <span class="hljs-literal">true</span>;
  }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>Kind of weird, but ensures prior behavior isn't broken in cases
that wouldn't throw errors. E.g. both argv.port and options.port
were specified, but since argv.port is 8080, options.port will be
tried first instead.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  options.port = argv.port === DEFAULT_PORT
    ? defaultTo(options.port, argv.port)
    : defaultTo(argv.port, options.port);

  <span class="hljs-keyword">if</span> (options.port != <span class="hljs-literal">null</span>) {
    startDevServer(config, options);

    <span class="hljs-keyword">return</span>;
  }

  portfinder.basePort = DEFAULT_PORT;

  portfinder.getPort(<span class="hljs-function">(<span class="hljs-params">err, port</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-keyword">throw</span> err;
    }

    options.port = port;

    startDevServer(config, options);
  });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">startDevServer</span>(<span class="hljs-params">config, options</span>) </span>{
  <span class="hljs-keyword">const</span> log = createLogger(options);

  addEntries(config, options);

  <span class="hljs-keyword">let</span> compiler;

  <span class="hljs-keyword">try</span> {
    compiler = webpack(config);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-keyword">if</span> (err <span class="hljs-keyword">instanceof</span> webpack.WebpackOptionsValidationError) {
      log.error(colors.error(options.stats.colors, err.message));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>eslint-disable-next-line no-process-exit</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      process.exit(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">throw</span> err;
  }

  <span class="hljs-keyword">if</span> (options.progress) {
    <span class="hljs-keyword">new</span> webpack.ProgressPlugin({
      <span class="hljs-attr">profile</span>: argv.profile
    }).apply(compiler);
  }

  <span class="hljs-keyword">const</span> suffix = (options.inline !== <span class="hljs-literal">false</span> || options.lazy === <span class="hljs-literal">true</span> ? <span class="hljs-string">'/'</span> : <span class="hljs-string">'/webpack-dev-server/'</span>);

  <span class="hljs-keyword">try</span> {
    server = <span class="hljs-keyword">new</span> Server(compiler, options, log);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-keyword">if</span> (err.name === <span class="hljs-string">'ValidationError'</span>) {
      log.error(colors.error(options.stats.colors, err.message));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>eslint-disable-next-line no-process-exit</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      process.exit(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">throw</span> err;
  }

  <span class="hljs-keyword">if</span> (options.socket) {
    server.listeningApp.on(<span class="hljs-string">'error'</span>, (e) =&gt; {
      <span class="hljs-keyword">if</span> (e.code === <span class="hljs-string">'EADDRINUSE'</span>) {
        <span class="hljs-keyword">const</span> clientSocket = <span class="hljs-keyword">new</span> net.Socket();

        clientSocket.on(<span class="hljs-string">'error'</span>, (err) =&gt; {
          <span class="hljs-keyword">if</span> (err.code === <span class="hljs-string">'ECONNREFUSED'</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>No other server listening on this socket so it can be safely removed</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            fs.unlinkSync(options.socket);

            server.listen(options.socket, options.host, (error) =&gt; {
              <span class="hljs-keyword">if</span> (error) {
                <span class="hljs-keyword">throw</span> error;
              }
            });
          }
        });

        clientSocket.connect({ <span class="hljs-attr">path</span>: options.socket }, () =&gt; {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'This socket is already used'</span>);
        });
      }
    });

    server.listen(options.socket, options.host, (err) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-keyword">throw</span> err;
      }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>chmod 666 (rw rw rw)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">const</span> READ_WRITE = <span class="hljs-number">438</span>;

      fs.chmod(options.socket, READ_WRITE, (err) =&gt; {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-keyword">throw</span> err;
        }

        <span class="hljs-keyword">const</span> uri = createDomain(options, server.listeningApp) + suffix;

        status(uri, options, log, argv.color);
      });
    });
  } <span class="hljs-keyword">else</span> {
    server.listen(options.port, options.host, (err) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-keyword">throw</span> err;
      }

      <span class="hljs-keyword">if</span> (options.bonjour) {
        bonjour(options);
      }

      <span class="hljs-keyword">const</span> uri = createDomain(options, server.listeningApp) + suffix;

      status(uri, options, log, argv.color);
    });
  }
}

processOptions(config);

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
