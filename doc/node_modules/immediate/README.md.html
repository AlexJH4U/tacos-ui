<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/immediate/README.md";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#immediate">immediate </a>
      </div>

      <div class="heading h2">
        <a href="#introduction">Introduction</a>
      </div>

      <div class="heading h2">
        <a href="#the-tricks">The Tricks</a>
      </div>

      <div class="heading h3">
        <a href="#process.nexttick">process.nextTick</a>
      </div>

      <div class="heading h3">
        <a href="#mutationobserver">MutationObserver</a>
      </div>

      <div class="heading h3">
        <a href="#messagechannel">MessageChannel</a>
      </div>

      <div class="heading h3">
        <a href="#lessscriptgreater-onreadystatechange">&amp;lt;script&amp;gt; onreadystatechange</a>
      </div>

      <div class="heading h2">
        <a href="#tricks-we-dont-use">Tricks we don&#39;t use</a>
      </div>

      <div class="heading h3">
        <a href="#setimmediate">setImmediate</a>
      </div>

      <div class="heading h2">
        <a href="#reference-and-reading">Reference and Reading</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="immediate">
  <h1>
    <a href="#immediate" name="immediate" class="pilcrow"></a>
immediate <a href="https://travis-ci.org/calvinmetcalf/immediate"><img src="https://travis-ci.org/calvinmetcalf/immediate.svg?branch=master" alt="Build Status"></a>
  </h1>
</div>
<pre><code>npm install immediate --save
</code></pre>
<p>then</p>
<pre><code class="js"><span class="hljs-keyword">var</span> immediate = <span class="hljs-built_in">require</span>(<span class="hljs-string">"immediate"</span>);

immediate(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// this will run soon</span>
});

immediate(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">arg1, arg2</span>) </span>{
  <span class="hljs-comment">// get your args like in iojs</span>
}, thing1, thing2);
</code></pre>
<div class="pilwrap" id="introduction">
  <h2>
    <a href="#introduction" name="introduction" class="pilcrow"></a>
Introduction
  </h2>
</div>
<p><strong>immediate</strong> is a microtask library, decended from <a href="https://github.com/NobleJS/setImmediate">NobleJS's setImmediate</a>, but including ideas from <a href="https://github.com/cujojs/when">Cujo's When</a> and <a href="https://github.com/tildeio/rsvp.js">RSVP</a>.</p>
<p>immediate takes the tricks from setImmedate and RSVP and combines them with the schedualer inspired (vaugly) by whens.</p>
<p>Note versions 2.6.5 and earlier were strictly speaking a 'macrotask' library not a microtask one, <a href="https://github.com/YuzuJS/setImmediate#macrotasks-and-microtasks">see this for the difference</a>, if you need a macrotask library, <a href="https://github.com/calvinmetcalf/macrotask">I got you covered</a>.</p>
<p>Several new features were added in versions 3.1.0 and 3.2.0 to maintain parity with
process.nextTick, but the 3.0.x series is still being kept up to date if you just need
the small barebones version.</p>
<div class="pilwrap" id="the-tricks">
  <h2>
    <a href="#the-tricks" name="the-tricks" class="pilcrow"></a>
The Tricks
  </h2>
</div>
<div class="pilwrap" id="process.nexttick">
  <h3>
    <a href="#process.nexttick" name="process.nexttick" class="pilcrow"></a>
<code>process.nextTick</code>
  </h3>
</div>
<p>Note that we check for <em>actual</em> Node.js environments, not emulated ones like those produced by browserify or similar.</p>
<div class="pilwrap" id="mutationobserver">
  <h3>
    <a href="#mutationobserver" name="mutationobserver" class="pilcrow"></a>
<code>MutationObserver</code>
  </h3>
</div>
<p>This is what <a href="https://github.com/tildeio/rsvp.js">RSVP</a> uses, it's very fast, details on <a href="https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver">MDN</a>.</p>
<div class="pilwrap" id="messagechannel">
  <h3>
    <a href="#messagechannel" name="messagechannel" class="pilcrow"></a>
<code>MessageChannel</code>
  </h3>
</div>
<p>Unfortunately, <code>postMessage</code> has completely different semantics inside web workers, and so cannot be used there. So we
turn to <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/web-messaging.html#channel-messaging"><code>MessageChannel</code></a>, which has worse browser support, but does work inside a web worker.</p>
<div class="pilwrap" id="lessscriptgreater-onreadystatechange">
  <h3>
    <a href="#lessscriptgreater-onreadystatechange" name="lessscriptgreater-onreadystatechange" class="pilcrow"></a>
<code>&lt;script&gt; onreadystatechange</code>
  </h3>
</div>
<p>For our last trick, we pull something out to make things fast in Internet Explorer versions 6 through 8: namely,
creating a <code>&lt;script&gt;</code> element and firing our calls in its <code>onreadystatechange</code> event. This does execute in a future
turn of the event loop, and is also faster than <code>setTimeout(â€¦, 0)</code>, so hey, why not?</p>
<div class="pilwrap" id="tricks-we-dont-use">
  <h2>
    <a href="#tricks-we-dont-use" name="tricks-we-dont-use" class="pilcrow"></a>
Tricks we don't use
  </h2>
</div>
<div class="pilwrap" id="setimmediate">
  <h3>
    <a href="#setimmediate" name="setimmediate" class="pilcrow"></a>
<code>setImmediate</code>
  </h3>
</div>
<p>We avoid this process.nextTick in node is better suited to our needs and in Internet Explorer 10 there is a broken version of setImmediate we avoid using this.</p>
<p>In Node.js, do</p>
<pre><code>npm install immediate
</code></pre>
<p>then</p>
<pre><code class="js"><span class="hljs-keyword">var</span> immediate = <span class="hljs-built_in">require</span>(<span class="hljs-string">"immediate"</span>);
</code></pre>
<div class="pilwrap" id="reference-and-reading">
  <h2>
    <a href="#reference-and-reading" name="reference-and-reading" class="pilcrow"></a>
Reference and Reading
  </h2>
</div>
<ul>
<li><a href="https://dvcs.w3.org/hg/webperf/raw-file/tip/specs/setImmediate/Overview.html">Efficient Script Yielding W3C Editor's Draft</a></li>
<li><a href="http://lists.w3.org/Archives/Public/public-web-perf/2011Jun/0100.html">W3C mailing list post introducing the specification</a></li>
<li><a href="http://ie.microsoft.com/testdrive/Performance/setImmediateSorting/Default.html">IE Test Drive demo</a></li>
<li><a href="http://www.nczonline.net/blog/2011/09/19/script-yielding-with-setimmediate/">Introductory blog post by Nicholas C. Zakas</a></li>
<li>I wrote a couple blog pots on this, <a href="http://calvinmetcalf.com/post/61672207151/setimmediate-etc">part 1</a> and <a href="http://calvinmetcalf.com/post/61761231881/javascript-schedulers">part 2</a></li>
</ul>
</div>
  </div>
</body>
</html>
