<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/internal-ip/index.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>index.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">'use strict'</span>;
<span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);
<span class="hljs-keyword">const</span> defaultGateway = <span class="hljs-built_in">require</span>(<span class="hljs-string">'default-gateway'</span>);
<span class="hljs-keyword">const</span> ipaddr = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ipaddr.js'</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findIp</span>(<span class="hljs-params">gateway</span>) </span>{
	<span class="hljs-keyword">const</span> interfaces = os.networkInterfaces();
	<span class="hljs-keyword">const</span> gatewayIp = ipaddr.parse(gateway);
	<span class="hljs-keyword">let</span> ip;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Look for the matching interface in all local interfaces</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-built_in">Object</span>.keys(interfaces).some(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {
		<span class="hljs-keyword">return</span> interfaces[name].some(<span class="hljs-function"><span class="hljs-params">addr</span> =&gt;</span> {
			<span class="hljs-keyword">const</span> prefix = ipaddr.parse(addr.netmask).prefixLengthFromSubnetMask();
			<span class="hljs-keyword">const</span> net = ipaddr.parseCIDR(<span class="hljs-string">`<span class="hljs-subst">${addr.address}</span>/<span class="hljs-subst">${prefix}</span>`</span>);

			<span class="hljs-keyword">if</span> (net[<span class="hljs-number">0</span>] &amp;&amp; net[<span class="hljs-number">0</span>].kind() === gatewayIp.kind() &amp;&amp; gatewayIp.match(net)) {
				ip = net[<span class="hljs-number">0</span>].toString();
			}

			<span class="hljs-keyword">return</span> <span class="hljs-built_in">Boolean</span>(ip);
		});
	});

	<span class="hljs-keyword">return</span> ip;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">promise</span>(<span class="hljs-params">family</span>) </span>{
	<span class="hljs-keyword">return</span> defaultGateway[family]().then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
		<span class="hljs-keyword">return</span> findIp(result.gateway) || <span class="hljs-literal">null</span>;
	}).catch(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-literal">null</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sync</span>(<span class="hljs-params">family</span>) </span>{
	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">const</span> result = defaultGateway[family].sync();
		<span class="hljs-keyword">return</span> findIp(result.gateway) || <span class="hljs-literal">null</span>;
	} <span class="hljs-keyword">catch</span> (err) {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
	}
}

<span class="hljs-built_in">module</span>.exports.v6 = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> promise(<span class="hljs-string">'v6'</span>);
<span class="hljs-built_in">module</span>.exports.v4 = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> promise(<span class="hljs-string">'v4'</span>);

<span class="hljs-built_in">module</span>.exports.v6.sync = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> sync(<span class="hljs-string">'v6'</span>);
<span class="hljs-built_in">module</span>.exports.v4.sync = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> sync(<span class="hljs-string">'v4'</span>);

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
