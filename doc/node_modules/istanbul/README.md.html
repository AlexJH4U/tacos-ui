<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/istanbul/README.md";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h2">
        <a href="#istanbul-a-js-code-coverage-tool-written-in-js">Istanbul - a JS code coverage tool written in JS</a>
      </div>

      <div class="heading h3">
        <a href="#features">Features</a>
      </div>

      <div class="heading h3">
        <a href="#use-cases">Use cases</a>
      </div>

      <div class="heading h3">
        <a href="#getting-started">Getting started</a>
      </div>

      <div class="heading h3">
        <a href="#usage-on-windows">Usage on Windows</a>
      </div>

      <div class="heading h3">
        <a href="#configuring">Configuring</a>
      </div>

      <div class="heading h3">
        <a href="#the-command-line">The command line</a>
      </div>

      <div class="heading h4">
        <a href="#the-cover-command">The cover command</a>
      </div>

      <div class="heading h4">
        <a href="#the-test-command">The test command</a>
      </div>

      <div class="heading h4">
        <a href="#the-instrument-command">The instrument command</a>
      </div>

      <div class="heading h4">
        <a href="#the-report-command">The report command</a>
      </div>

      <div class="heading h4">
        <a href="#the-check-coverage-command">The check-coverage command</a>
      </div>

      <div class="heading h3">
        <a href="#ignoring-code-for-coverage">Ignoring code for coverage</a>
      </div>

      <div class="heading h3">
        <a href="#api">API</a>
      </div>

      <div class="heading h4">
        <a href="#instrument-code">Instrument code</a>
      </div>

      <div class="heading h4">
        <a href="#generate-reports-given-a-bunch-of-coverage-json-objects">Generate reports given a bunch of coverage JSON objects</a>
      </div>

      <div class="heading h3">
        <a href="#multiple-process-usage">Multiple Process Usage</a>
      </div>

      <div class="heading h3">
        <a href="#coverage.json">Coverage.json</a>
      </div>

      <div class="heading h3">
        <a href="#license">License</a>
      </div>

      <div class="heading h3">
        <a href="#third-party-libraries">Third-party libraries</a>
      </div>

      <div class="heading h3">
        <a href="#inspired-by">Inspired by</a>
      </div>

      <div class="heading h3">
        <a href="#shout-out-to">Shout out to</a>
      </div>

      <div class="heading h3">
        <a href="#why-the-funky-name">Why the funky name?</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="istanbul-a-js-code-coverage-tool-written-in-js">
  <h2>
    <a href="#istanbul-a-js-code-coverage-tool-written-in-js" name="istanbul-a-js-code-coverage-tool-written-in-js" class="pilcrow"></a>
Istanbul - a JS code coverage tool written in JS
  </h2>
</div>
<p><a href="http://travis-ci.org/gotwarlost/istanbul"><img src="https://secure.travis-ci.org/gotwarlost/istanbul.svg?branch=master" alt="Build Status"></a>
<a href="https://gemnasium.com/gotwarlost/istanbul"><img src="https://gemnasium.com/gotwarlost/istanbul.svg" alt="Dependency Status"></a>
<a href="https://coveralls.io/r/gotwarlost/istanbul?branch=master"><img src="https://img.shields.io/coveralls/gotwarlost/istanbul.svg" alt="Coverage Status"></a>
<a href="https://www.bithound.io/github/gotwarlost/istanbul"><img src="https://www.bithound.io/github/gotwarlost/istanbul/badges/score.svg" alt="bitHound Score"></a></p>
<p><a href="https://nodei.co/npm/istanbul/"><img src="https://nodei.co/npm/istanbul.png?downloads=true" alt="NPM"></a></p>
<p><strong>New</strong> <code>v0.4.0</code> now has beautiful HTML reports. Props to Tom MacWright @tmcw for a fantastic job!</p>
<ul>
<li><a href="#features.html">Features and use cases</a></li>
<li><a href="#getting-started.html">Getting started and configuration</a></li>
<li><a href="#usage-on-windows.html">Usage on Windows</a></li>
<li><a href="#the-command-line.html">The command line</a></li>
<li><a href="#ignoring-code-for-coverage.html">Ignoring code for coverage</a></li>
<li><a href="#api.html">API</a></li>
<li><a href="https://github.com/gotwarlost/istanbul/blob/master/CHANGELOG.md">Changelog</a></li>
<li><a href="#license.html">License and credits</a></li>
</ul>
<div class="pilwrap" id="features">
  <h3>
    <a href="#features" name="features" class="pilcrow"></a>
Features
  </h3>
</div>
<ul>
<li>All-javascript instrumentation library that tracks <strong>statement, branch,
and function coverage</strong>.</li>
<li><strong>Module loader hooks</strong> to instrument code on the fly</li>
<li><strong>Command line tools</strong> to run node unit tests &quot;with coverage turned on&quot; and no cooperation
whatsoever from the test runner</li>
<li>Multiple report formats: <strong>HTML</strong>, <strong>LCOV</strong>, <strong>Cobertura</strong> and more.</li>
<li>Ability to use as <a href="https://github.com/gotwarlost/istanbul-middleware">middleware</a> when serving JS files that need to be tested on the browser.</li>
<li>Can be used on the <strong>command line</strong> as well as a <strong>library</strong></li>
<li>Based on the awesome <code>esprima</code> parser and the equally awesome <code>escodegen</code> code generator</li>
<li>Well-tested on node (prev, current and next versions) and the browser (instrumentation library only)</li>
</ul>
<div class="pilwrap" id="use-cases">
  <h3>
    <a href="#use-cases" name="use-cases" class="pilcrow"></a>
Use cases
  </h3>
</div>
<p>Supports the following use cases and more</p>
<ul>
<li>transparent coverage of nodejs unit tests</li>
<li>instrumentation/ reporting of files in batch mode for browser tests</li>
<li>Server side code coverage for nodejs by embedding it as <a href="https://github.com/gotwarlost/istanbul-middleware">custom middleware</a></li>
</ul>
<div class="pilwrap" id="getting-started">
  <h3>
    <a href="#getting-started" name="getting-started" class="pilcrow"></a>
Getting started
  </h3>
</div>
<pre><code>$ npm install -g istanbul
</code></pre>
<p>The best way to see it in action is to run node unit tests. Say you have a test
script <code>test.js</code> that runs all tests for your node project without coverage.</p>
<p>Simply:</p>
<pre><code>$ cd /path/to/your/source/root
$ istanbul cover test.js
</code></pre>
<p>and this should produce a <code>coverage.json</code>, <code>lcov.info</code> and <code>lcov-report/*html</code> under <code>./coverage</code></p>
<p>Sample of code coverage reports produced by this tool (for this tool!):</p>
<p><a href="http://gotwarlost.github.com/istanbul/public/coverage/lcov-report/index.html">HTML reports</a></p>
<div class="pilwrap" id="usage-on-windows">
  <h3>
    <a href="#usage-on-windows" name="usage-on-windows" class="pilcrow"></a>
Usage on Windows
  </h3>
</div>
<p>Istanbul assumes that the <code>command</code> passed to it is a JS file (e.g. Jasmine, vows etc.),
this is however not true on Windows where npm wrap bin files in a <code>.cmd</code> file.
Since Istanbul can not parse <code>.cmd</code> files you need to reference the bin file manually.</p>
<p>Here is an example using Jasmine 2:</p>
<pre><code>istanbul cover node_modules\jasmine\bin\jasmine.js
</code></pre>
<p>In order to use this cross platform (e.i. Linux, Mac and Windows), you can insert
the above line into the script object in your package.json file but with normal
slash.</p>
<pre><code>&quot;scripts&quot;: {
    &quot;test&quot;: &quot;istanbul cover node_modules/jasmine/bin/jasmine.js&quot;
}
</code></pre>
<div class="pilwrap" id="configuring">
  <h3>
    <a href="#configuring" name="configuring" class="pilcrow"></a>
Configuring
  </h3>
</div>
<p>Drop a <code>.istanbul.yml</code> file at the top of the source tree to configure istanbul.
<code>istanbul help config</code> tells you more about the config file format.</p>
<div class="pilwrap" id="the-command-line">
  <h3>
    <a href="#the-command-line" name="the-command-line" class="pilcrow"></a>
The command line
  </h3>
</div>
<pre><code>$ istanbul help
</code></pre>
<p>gives you detailed help on all commands.</p>
<pre><code>Usage: istanbul help config | &lt;command&gt;

`config` provides help with istanbul configuration

Available commands are:

      check-coverage
              checks overall/per-file coverage against thresholds from coverage
              JSON files. Exits 1 if thresholds are not met, 0 otherwise


      cover   transparently adds coverage information to a node command. Saves
              coverage.json and reports at the end of execution


      help    shows help


      instrument
              instruments a file or a directory tree and writes the
              instrumented code to the desired output location


      report  writes reports for coverage JSON objects produced in a previous
              run


      test    cover a node command only when npm_config_coverage is set. Use in
              an `npm test` script for conditional coverage


Command names can be abbreviated as long as the abbreviation is unambiguous
</code></pre>
<p>To get detailed help for a command and what command-line options it supports, run:</p>
<pre><code>istanbul help &lt;command&gt;
</code></pre>
<p>(Most of the command line options are not covered in this document.)</p>
<div class="pilwrap" id="the-cover-command">
  <h4>
    <a href="#the-cover-command" name="the-cover-command" class="pilcrow"></a>
The <code>cover</code> command
  </h4>
</div>
<pre><code>$ istanbul cover my-test-script.js -- my test args
# note the -- between the command name and the arguments to be passed
</code></pre>
<p>The <code>cover</code> command can be used to get a coverage object and reports for any arbitrary
node script. By default, coverage information is written under <code>./coverage</code> - this
can be changed using command-line options.</p>
<p>The <code>cover</code> command can also be passed an optional <code>--handle-sigint</code> flag to
enable writing reports when a user triggers a manual SIGINT of the process that is
being covered. This can be useful when you are generating coverage for a long lived process.</p>
<div class="pilwrap" id="the-test-command">
  <h4>
    <a href="#the-test-command" name="the-test-command" class="pilcrow"></a>
The <code>test</code> command
  </h4>
</div>
<p>The <code>test</code> command has almost the same behavior as the <code>cover</code> command, except that
it skips coverage unless the <code>npm_config_coverage</code> environment variable is set.</p>
<p><strong>This command is deprecated</strong> since the latest versions of npm do not seem to
set the <code>npm_config_coverage</code> variable.</p>
<div class="pilwrap" id="the-instrument-command">
  <h4>
    <a href="#the-instrument-command" name="the-instrument-command" class="pilcrow"></a>
The <code>instrument</code> command
  </h4>
</div>
<p>Instruments a single JS file or an entire directory tree and produces an output
directory tree with instrumented code. This should not be required for running node
unit tests but is useful for tests to be run on the browser.</p>
<div class="pilwrap" id="the-report-command">
  <h4>
    <a href="#the-report-command" name="the-report-command" class="pilcrow"></a>
The <code>report</code> command
  </h4>
</div>
<p>Writes reports using <code>coverage*.json</code> files as the source of coverage information.
Reports are available in multiple formats and can be individually configured
using the istanbul config file. See <code>istanbul help report</code> for more details.</p>
<div class="pilwrap" id="the-check-coverage-command">
  <h4>
    <a href="#the-check-coverage-command" name="the-check-coverage-command" class="pilcrow"></a>
The <code>check-coverage</code> command
  </h4>
</div>
<p>Checks the coverage of statements, functions, branches, and lines against the
provided thresholds. Positive thresholds are taken to be the minimum percentage
required and negative numbers are taken to be the number of uncovered entities
allowed.</p>
<div class="pilwrap" id="ignoring-code-for-coverage">
  <h3>
    <a href="#ignoring-code-for-coverage" name="ignoring-code-for-coverage" class="pilcrow"></a>
Ignoring code for coverage
  </h3>
</div>
<ul>
<li>Skip an <code>if</code> or <code>else</code> path with <code>/* istanbul ignore if */</code> or <code>/* istanbul ignore else */</code> respectively.</li>
<li>For all other cases, skip the next 'thing' in the source with: <code>/* istanbul ignore next */</code></li>
</ul>
<p>See <a href="ignoring-code-for-coverage.md.html">ignoring-code-for-coverage.md</a> for the spec.</p>
<div class="pilwrap" id="api">
  <h3>
    <a href="#api" name="api" class="pilcrow"></a>
API
  </h3>
</div>
<p>All the features of istanbul can be accessed as a library.</p>
<div class="pilwrap" id="instrument-code">
  <h4>
    <a href="#instrument-code" name="instrument-code" class="pilcrow"></a>
Instrument code
  </h4>
</div>
<pre><code class="javascript">    <span class="hljs-keyword">var</span> istanbul = <span class="hljs-built_in">require</span>(<span class="hljs-string">'istanbul'</span>);
    <span class="hljs-keyword">var</span> instrumenter = <span class="hljs-keyword">new</span> istanbul.Instrumenter();

    <span class="hljs-keyword">var</span> generatedCode = instrumenter.instrumentSync(<span class="hljs-string">'function meaningOfLife() { return 42; }'</span>,
        <span class="hljs-string">'filename.js'</span>);
</code></pre>
<div class="pilwrap" id="generate-reports-given-a-bunch-of-coverage-json-objects">
  <h4>
    <a href="#generate-reports-given-a-bunch-of-coverage-json-objects" name="generate-reports-given-a-bunch-of-coverage-json-objects" class="pilcrow"></a>
Generate reports given a bunch of coverage JSON objects
  </h4>
</div>
<pre><code class="javascript">    <span class="hljs-keyword">var</span> istanbul = <span class="hljs-built_in">require</span>(<span class="hljs-string">'istanbul'</span>),
        collector = <span class="hljs-keyword">new</span> istanbul.Collector(),
        reporter = <span class="hljs-keyword">new</span> istanbul.Reporter(),
        sync = <span class="hljs-literal">false</span>;

    collector.add(obj1);
    collector.add(obj2); <span class="hljs-comment">//etc.</span>

    reporter.add(<span class="hljs-string">'text'</span>);
    reporter.addAll([ <span class="hljs-string">'lcov'</span>, <span class="hljs-string">'clover'</span> ]);
    reporter.write(collector, sync, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'All reports generated'</span>);
    });
</code></pre>
<p>For the gory details consult the <a href="http://gotwarlost.github.com/istanbul/public/apidocs/index.html">public API</a></p>
<div class="pilwrap" id="multiple-process-usage">
  <h3>
    <a href="#multiple-process-usage" name="multiple-process-usage" class="pilcrow"></a>
Multiple Process Usage
  </h3>
</div>
<p>Istanbul can be used in a multiple process environment by running each process
with Istanbul, writing a unique coverage file for each process, and combining
the results when generating reports. The method used to perform this will
depend on the process forking API used. For example when using the
<a href="http://nodejs.org/api/cluster.html">cluster module</a> you must setup the master
to start child processes with Istanbul coverage, disable reporting, and output
coverage files that include the PID in the filename.  Before each run you may
need to clear out the coverage data directory.</p>
<pre><code class="javascript">    <span class="hljs-keyword">if</span>(cluster.isMaster) {
        <span class="hljs-comment">// setup cluster if running with istanbul coverage</span>
        <span class="hljs-keyword">if</span>(process.env.running_under_istanbul) {
            <span class="hljs-comment">// use coverage for forked process</span>
            <span class="hljs-comment">// disabled reporting and output for child process</span>
            <span class="hljs-comment">// enable pid in child process coverage filename</span>
            cluster.setupMaster({
                <span class="hljs-attr">exec</span>: <span class="hljs-string">'./node_modules/.bin/istanbul'</span>,
                <span class="hljs-attr">args</span>: [
                    <span class="hljs-string">'cover'</span>, <span class="hljs-string">'--report'</span>, <span class="hljs-string">'none'</span>, <span class="hljs-string">'--print'</span>, <span class="hljs-string">'none'</span>, <span class="hljs-string">'--include-pid'</span>,
                    process.argv[<span class="hljs-number">1</span>], <span class="hljs-string">'--'</span>].concat(process.argv.slice(<span class="hljs-number">2</span>))
            });
        }
        <span class="hljs-comment">// ...</span>
        <span class="hljs-comment">// ... cluster.fork();</span>
        <span class="hljs-comment">// ...</span>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// ... worker code</span>
    }
</code></pre>
<div class="pilwrap" id="coverage.json">
  <h3>
    <a href="#coverage.json" name="coverage.json" class="pilcrow"></a>
Coverage.json
  </h3>
</div>
<p>For details on the format of the coverage.json object, <a href="./coverage.json.md.html">see here</a>.</p>
<div class="pilwrap" id="license">
  <h3>
    <a href="#license" name="license" class="pilcrow"></a>
License
  </h3>
</div>
<p>istanbul is licensed under the <a href="http://github.com/gotwarlost/istanbul/raw/master/LICENSE">BSD License</a>.</p>
<div class="pilwrap" id="third-party-libraries">
  <h3>
    <a href="#third-party-libraries" name="third-party-libraries" class="pilcrow"></a>
Third-party libraries
  </h3>
</div>
<p>The following third-party libraries are used by this module:</p>
<ul>
<li>abbrev: https://github.com/isaacs/abbrev-js -  to handle command abbreviations</li>
<li>async: https://github.com/caolan/async - for parallel instrumentation of files</li>
<li>escodegen: https://github.com/Constellation/escodegen - for JS code generation</li>
<li>esprima: https://github.com/ariya/esprima - for JS parsing</li>
<li>glob: https://github.com/isaacs/node-glob - for loading and matching path expressions</li>
<li>handlebars: https://github.com/wycats/handlebars.js/ - for report template expansion</li>
<li>js-yaml: https://github.com/nodeca/js-yaml - for YAML config file load</li>
<li>mkdirp: https://github.com/substack/node-mkdirp - to create output directories</li>
<li>nodeunit: https://github.com/caolan/nodeunit - dev dependency for unit tests</li>
<li>nopt: https://github.com/isaacs/nopt - for option parsing</li>
<li>once: https://github.com/isaacs/once - to ensure callbacks are called once</li>
<li>resolve: https://github.com/substack/node-resolve - for resolving a post-require hook module name into its main file.</li>
<li>rimraf - https://github.com/isaacs/rimraf - dev dependency for unit tests</li>
<li>which: https://github.com/isaacs/node-which - to resolve a node command to a file for the <code>cover</code> command</li>
<li>wordwrap: https://github.com/substack/node-wordwrap - for prettier help</li>
<li>prettify: http://code.google.com/p/google-code-prettify/ - for syntax colored HTML reports. Files checked in under <code>lib/vendor/</code></li>
</ul>
<div class="pilwrap" id="inspired-by">
  <h3>
    <a href="#inspired-by" name="inspired-by" class="pilcrow"></a>
Inspired by
  </h3>
</div>
<ul>
<li>YUI test coverage - https://github.com/yui/yuitest - the grand-daddy of JS coverage tools. Istanbul has been specifically designed to offer an alternative to this library with an easy migration path.</li>
<li>cover: https://github.com/itay/node-cover - the inspiration for the <code>cover</code> command, modeled after the <code>run</code> command in that tool. The coverage methodology used by istanbul is quite different, however</li>
</ul>
<div class="pilwrap" id="shout-out-to">
  <h3>
    <a href="#shout-out-to" name="shout-out-to" class="pilcrow"></a>
Shout out to
  </h3>
</div>
<ul>
<li><a href="https://github.com/mfncooper">mfncooper</a> - for great brainstorming discussions</li>
<li><a href="https://github.com/reid">reid</a>, <a href="https://github.com/davglass">davglass</a>, the YUI dudes, for interesting conversations, encouragement, support and gentle pressure to get it done :)</li>
</ul>
<div class="pilwrap" id="why-the-funky-name">
  <h3>
    <a href="#why-the-funky-name" name="why-the-funky-name" class="pilcrow"></a>
Why the funky name?
  </h3>
</div>
<p>Since all the good ones are taken. Comes from the loose association of ideas across
coverage, carpet-area coverage, the country that makes good carpets and so on...</p>
</div>
  </div>
</body>
</html>
